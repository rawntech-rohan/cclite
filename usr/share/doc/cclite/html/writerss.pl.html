<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>writerss.pl</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #F0F0F0;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
<body style="background-color: white">
<a name="-top-"></a>
<h1>writerss.pl</h1>

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#description">description</a></li>
</ul>
<!-- INDEX END -->
<h2>Code Index:</h2>
<!-- BEGIN CODE INDEX --><a name="code-index"></a>
<ul>
<li><a href="#__END__-">__END__</a></li>
<li><a href="#EOF-">EOF</a></li>
</ul>
<!-- END CODE INDEX -->

<hr />
<p></p>
<hr />
<h1><a name="description">description</a></h1>
<p>write.rss writing news feeds for cclite adverts</p>
<p>THE cclite SOFTWARE IS PROVIDED TO YOU ``AS IS,'' AND WE MAKE NO EXPRESS
OR IMPLIED WARRANTIES WHATSOEVER WITH RESPECT TO ITS FUNCTIONALITY, 
OPERABILITY, OR USE, INCLUDING, WITHOUT LIMITATION, 
ANY IMPLIED WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE, OR INFRINGEMENT. 
WE EXPRESSLY DISCLAIM ANY LIABILITY WHATSOEVER FOR ANY DIRECT, 
INDIRECT, CONSEQUENTIAL, INCIDENTAL OR SPECIAL DAMAGES, 
INCLUDING, WITHOUT LIMITATION, LOST REVENUES, LOST PROFITS, 
LOSSES RESULTING FROM BUSINESS INTERRUPTION OR LOSS OF DATA, 
REGARDLESS OF THE FORM OF ACTION OR LEGAL THEORY UNDER 
WHICH THE LIABILITY MAY BE ASSERTED, 
EVEN IF ADVISED OF THE POSSIBILITY OR LIKELIHOOD OF SUCH DAMAGES.</p>
<p>You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</p>

<hr /><pre>#!/usr/bin/perl

</pre><pre>
<span class="c">#</span>

<span class="k">print</span> <span class="i">STDOUT</span> <span class="q">&quot;Content-type: text/html\n\n&quot;</span><span class="sc">;</span>
<span class="k">my</span> <span class="i">$data</span> = <span class="k">join</span><span class="s">(</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="q">&lt;DATA&gt;</span> <span class="s">)</span><span class="sc">;</span>
<span class="k">eval</span> <span class="i">$data</span><span class="sc">;</span>
<span class="k">if</span> <span class="s">(</span><span class="i">$@</span><span class="s">)</span> <span class="s">{</span>
    <span class="k">print</span> <span class="i">$@</span><span class="sc">;</span>
    <span class="k">exit</span> <span class="n">1</span><span class="sc">;</span>
<span class="s">}</span>

<a name="__END__-"></a><span class="k">__END__</span>

<span class="q">#-----------------------------------------------------------</span>
<span class="q"># This is the batch program that writes rss files.</span>
<span class="q"># When a new advert arrives it will be inlcuded in the rss</span>
<span class="q">#</span>
<span class="q"># On a linux system it will be run as a cron job..on some</span>
<span class="q"># Windows, as an &#39;at&#39; of some kind, I guess.</span>
<span class="q"># </span>
<span class="q">#</span>
<span class="q"># To install:</span>
<span class="q">#</span>
<span class="q"># Change the library path and the database array, since</span>
<span class="q"># this is installation dependent. Probably, one mail file</span>
<span class="q"># will belong to one registry</span>
<span class="q">#</span>
<span class="q"># use sudo apt-get install liferea for example to read the </span>
<span class="q"># resulting feeds which are at an url like:</span>
<span class="q"># http://cclite.private.server/cclite/html/en/rss/limehouse.rdf</span>
<span class="q"># for a registry called limehouse, for example</span>

<span class="q"># use Log::Log4perl;</span>
<span class="q"># Log::Log4perl-&gt;init($configuration{&#39;loggerconfig&#39;});</span>
<span class="q"># our $log = Log::Log4perl-&gt;get_logger(&quot;writerss&quot;);</span>


<span class="q">use lib &quot;$configuration{librarypath}&quot;;	</span>
<span class="q">use Ccu;</span>
<span class="q">use Ccrss ;</span>
<span class="q">use Cccookie ; # to get the registry token from the admin page...</span>
<span class="q">use Ccconfiguration ;</span>

<span class="q">my $token ;</span>


<span class="q"># you&#39;ll have to hardcode these, if this is a cron</span>
<span class="q">my $cookieref = get_cookie();</span>
<span class="q">my $registry = $$cookieref{registry} ;</span>
<span class="q">my $language = $$cookieref{language} ;</span>

<span class="q">my  %configuration  = readconfiguration();</span>

<span class="q"># these are the feed types, all ads, wanted ads, offered ads and matched ads, change this to the feeds that you need</span>
<span class="q">my @types = (all, wanted, offered, match) ;</span>

<span class="q">my %fields ;</span>

<span class="q"># this is the path where the rss files are written</span>
<span class="q"># needs to be writable by the server, rss is now by registry and by language</span>

<span class="q">$fields{&#39;rsspath&#39;}  =   $configuration{&#39;rsspath&#39;} ;</span>
<span class="q">$fields{&#39;language&#39;} =   $language ;</span>

<span class="q">if (-e $fields{&#39;rsspath&#39;} ) {</span>
<span class="q">} else {</span>
   
<span class="q">  mkdir($fields{&#39;rsspath&#39;}, 0777) || print $!;</span>
<span class="q">  exit 1 ;</span>
<span class="q">}</span>

<span class="q">my $email = $configuration{supportmail} ;</span>

<span class="q"># simply loop around each registry creating an rdf file </span>
<span class="q"># for the type of advert for each one</span>
<span class="q"> my $entry ;</span>
 
<span class="q">foreach $type (@types) {</span>
 
<span class="q">   $fields{type}	= $type ;</span>
<span class="q">   my $fieldsref 	= \%fields ;</span>
<span class="q"> my ($refresh,$metarefresh,$error,$html,$pagename,$cookies) 	= create_rss_feed(&#39;local&#39;,$configuration{&#39;home&#39;},&#39;desc&#39;,$email,$registry,&#39;om_yellowpages&#39;,$fieldsref,$token) ;</span>
<span class="q">}</span>

<span class="q">exit 0 ;</span>

<a name="EOF-"></a></pre></body>

</html>
